# نظام نسيان كلمة المرور - معروضي

## نظرة عامة
تم إنشاء نظام نسيان كلمة المرور بالكامل في التطبيق. النظام يعمل على 4 مراحل:

### المرحلة 1: إدخال البريد الإلكتروني
- المستخدم يدخل بريده الإلكتروني
- النظام يتحقق من وجود الحساب
- يتم إرسال رمز تحقق مكون من 6 أرقام إلى البريد الإلكتروني

### المرحلة 2: إدخال رمز التحقق
- المستخدم يدخل رمز التحقق المستلم
- النظام يتحقق من صحة الرمز وصلاحيته
- الرمز صالح لمدة 15 دقيقة فقط

### المرحلة 3: إدخال كلمة المرور الجديدة
- المستخدم يدخل كلمة المرور الجديدة
- تأكيد كلمة المرور
- التحقق من قوة كلمة المرور (8 أحرف على الأقل)

### المرحلة 4: نجاح العملية
- رسالة تأكيد نجاح تغيير كلمة المرور
- خيارات للعودة لتسجيل الدخول أو طلب جديد

## الملفات المطلوبة

### 1. صفحة نسيان كلمة المرور
- `src/app/forgot-password/page.tsx` - الصفحة الرئيسية

### 2. API Endpoints
- `src/app/api/auth/forgot-password/route.ts` - إرسال رمز التحقق
- `src/app/api/auth/verify-reset-token/route.ts` - التحقق من الرمز
- `src/app/api/auth/reset-password/route.ts` - تغيير كلمة المرور

### 3. قاعدة البيانات
- `prisma/schema.prisma` - يحتوي على نموذج `PasswordResetToken`

### 4. إرسال البريد الإلكتروني
- `src/lib/email.ts` - دوال إرسال البريد الإلكتروني

## متطلبات الإعداد

### 1. متغيرات البيئة (.env)
```env
# إعدادات البريد الإلكتروني
EMAIL_USER=m3roodi@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_APP_PASSWORD=your_app_password

# قاعدة البيانات
DATABASE_URL=your_database_url
```

### 2. تثبيت الحزم المطلوبة
```bash
npm install nodemailer bcryptjs
```

### 3. تشغيل قاعدة البيانات
```bash
npx prisma generate
npx prisma db push
```

## كيفية الاستخدام

### 1. الوصول للصفحة
- من صفحة تسجيل الدخول: انقر على "نسيت كلمة السر؟"
- أو مباشرة: `http://localhost:3000/forgot-password`

### 2. تدفق العملية
1. أدخل بريدك الإلكتروني
2. تحقق من بريدك الإلكتروني للحصول على رمز التحقق
3. أدخل رمز التحقق (6 أرقام)
4. أدخل كلمة المرور الجديدة
5. تأكيد كلمة المرور الجديدة
6. تم تغيير كلمة المرور بنجاح!

## الميزات الأمنية

### 1. حماية البيانات
- لا يتم إخبار المستخدم إذا كان البريد الإلكتروني موجود أم لا
- الرموز صالحة لمدة 15 دقيقة فقط
- يمكن استخدام الرمز مرة واحدة فقط

### 2. التحقق من قوة كلمة المرور
- الحد الأدنى 8 أحرف
- يجب تأكيد كلمة المرور

### 3. تشفير كلمة المرور
- استخدام bcrypt لتشفير كلمة المرور
- salt rounds: 12

## استكشاف الأخطاء

### 1. مشاكل البريد الإلكتروني
- تأكد من صحة `EMAIL_USER` و `EMAIL_PASSWORD`
- تأكد من تفعيل "App Password" في Gmail
- تحقق من إعدادات SMTP

### 2. مشاكل قاعدة البيانات
- تأكد من تشغيل قاعدة البيانات
- تحقق من صحة `DATABASE_URL`
- قم بتشغيل `npx prisma db push`

### 3. مشاكل الواجهة
- تأكد من تثبيت `react-hot-toast`
- تحقق من أن جميع المكونات UI موجودة

## اختبار النظام

### 1. اختبار التدفق الكامل
1. اذهب إلى `/forgot-password`
2. أدخل بريد إلكتروني صحيح
3. تحقق من استلام رمز التحقق
4. أدخل الرمز
5. أدخل كلمة مرور جديدة
6. تأكيد نجاح العملية

### 2. اختبار الأخطاء
- بريد إلكتروني غير صحيح
- رمز تحقق خاطئ
- رمز منتهي الصلاحية
- كلمة مرور ضعيفة
- عدم تطابق تأكيد كلمة المرور

## ملاحظات مهمة

1. **مدة صلاحية الرمز**: 15 دقيقة فقط
2. **طول كلمة المرور**: 8 أحرف على الأقل
3. **إعادة إرسال الرمز**: متاح في المرحلة 2
4. **العودة للخطوات السابقة**: متاح في جميع المراحل
5. **الأمان**: لا يتم إخبار المستخدم بوجود أو عدم وجود الحساب

## الدعم

إذا واجهت أي مشاكل، يرجى التواصل مع:
- البريد الإلكتروني: m3roodi@gmail.com
- أو إنشاء issue في المشروع
